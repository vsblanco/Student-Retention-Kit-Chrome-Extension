<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Student Retention Kit</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="sidepanel.css"/>
</head>
<body>

  <div class="container">
    <div class="header">
      <div class="title-area">
        <h2>Student Retention Kit</h2>
        <span id="versionText" title="Click to view Version History">Version --</span>
      </div>
      <button id="headerSettingsBtn" class="icon-btn" title="Settings">
        <i class="fas fa-cog"></i>
      </button>
    </div>

    <div class="tabs">
      <button class="tab-button active" data-tab="checker">
        <i class="fas fa-check-double"></i>
        Checker
        <span class="badge" style="background: #10b981; display:none;">0</span>
      </button>
      <button class="tab-button" data-tab="contact">
        <i class="fas fa-phone-volume"></i>
        Call
      </button>
      <button class="tab-button" data-tab="data">
        <i class="fas fa-database"></i>
        Data
      </button>
    </div>

    <div id="checker" class="tab-content active">
      <div class="loop-status">
        <button id="startBtn">
            <i class="fas fa-play"></i>
            <span id="startBtnText">Start</span>
        </button>
        <div style="display:flex; align-items:center; gap:8px; flex-grow:1;">
            <div class="status-dot" id="statusDot"></div>
            <span id="statusText">Ready to Scan</span>
        </div>
        <button id="scanFilterBtn" class="btn-secondary" style="padding: 6px 12px; font-size: 0.9em;" title="Configure scan filters">
            <i class="fas fa-filter"></i> Scan Filter
        </button>
      </div>

      <div class="section">
        <input type="text" placeholder="Filter found submissions..." style="margin-bottom: 12px;">
        <div id="foundCountText" style="font-size: 0.85em; color: var(--text-secondary); margin-bottom: 8px; text-align: center;">0 students submitted</div>

        <ul class="glass-list" id="foundList">
          </ul>
      </div>
      <button id="clearFoundListBtn" class="btn-secondary" style="margin-top:10px; width:100%; flex-shrink:0; display:none;">Clear List</button>
    </div>

    <div id="contact" class="tab-content">
      <div class="section">
        
        <div class="setting-card" style="margin-bottom: 15px; border-left: 4px solid #10b981;">
            <div style="display:flex; align-items:center; gap:12px;">
                 <div style="width:40px; height:40px; background:#e0e7ff; border-radius:50%; display:flex; align-items:center; justify-content:center; color:var(--primary-color); font-weight:bold; font-size: 0.9em;">JD</div>
                 <div>
                     <div style="font-weight:bold; color: #1a202c;">Doe, Jane</div>
                     <div style="font-size:0.8em; color:var(--text-secondary);">Parent: Mrs. Doe</div>
                 </div>
            </div>
            <button id="manageQueueBtn" class="btn-secondary" style="display:none; width:auto; font-size:0.75em; padding: 4px 8px;">Manage Queue</button>
        </div>

        <div class="call-interface-card">
            <div class="call-status-bar">
                <span class="status-indicator ready"></span> Ready to Connect
            </div>
            <div class="call-timer">00:00</div>
            
            <div class="phone-number-display">(555) 019-2834</div>
            
            <div class="call-controls-row">
                <button class="control-btn secondary-action mute" title="Mute"><i class="fas fa-microphone-slash"></i></button>
                
                <button class="control-btn dial" id="dialBtn">
                    <i class="fas fa-phone"></i>
                </button>

                <button class="control-btn hangup" id="hangupBtn" style="display:none;">
                    <i class="fas fa-phone-slash"></i>
                </button>
                
                <button class="control-btn secondary-action speaker" title="Speaker"><i class="fas fa-volume-up"></i></button>
            </div>
        </div>

        <div id="upNextCard" class="setting-card" style="display:none; background: rgba(107, 114, 128, 0.1); border-left: 4px solid #6b7280; padding: 8px 12px; margin-bottom: 10px;">
            <div style="display:flex; align-items:center; gap:10px; width: 100%; justify-content: space-between;">
                <div style="display:flex; align-items:center; gap:10px; flex-grow:1; min-width:0;">
                    <span style="font-size:0.7em; font-weight:700; color:#6b7280; text-transform:uppercase; white-space:nowrap;">
                        <i class="fas fa-forward"></i> Up Next
                    </span>
                    <div style="height: 16px; width: 1px; background: rgba(107, 114, 128, 0.3);"></div>
                    <div id="upNextName" style="font-weight:500; font-size:0.85em; color: var(--text-main); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                        Student Name
                    </div>
                </div>
                <button id="skipStudentBtn" class="skip-btn" title="Skip to next student">
                    <i class="fas fa-forward"></i>
                </button>
            </div>
        </div>

        <div id="callDispositionSection" style="display:none; margin-top:5px; flex-grow:1; flex-direction:column;">
            <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                <label style="font-size:0.9em; font-weight:500; color:#4b5563;">Call Disposition</label>
                <span id="lastCallTimestamp" style="font-size:0.8em; color:var(--text-secondary);">Last call: Never</span>
            </div>
            
            <div class="disposition-grid">
                <button class="disposition-btn">
                    <i class="fas fa-voicemail"></i> Left Voicemail
                </button>
                <button class="disposition-btn">
                    <i class="fas fa-check-circle"></i> Service Completed
                </button>
                <button class="disposition-btn">
                    <i class="fas fa-exclamation-triangle"></i> Outbound Error
                </button>
                <button class="disposition-btn">
                    <i class="fas fa-calendar-check"></i> Follow Up
                </button>
                <button class="disposition-btn">
                    <i class="fas fa-phone-slash"></i> No Answer
                </button>
                <button class="disposition-btn">
                    <i class="fas fa-unlink"></i> Disconnected
                </button>
            </div>
            
            <div id="otherInputArea" style="display:none; margin-top:10px;">
                <textarea id="customNote" style="width:100%; min-height:80px; padding:10px; border-radius:0.75rem; border:1px solid rgba(0,0,0,0.1); background:rgba(255,255,255,0.5);" placeholder="Enter custom call details..."></textarea>
                <button class="btn-primary" style="margin-top:10px;">Confirm & End Call</button>
            </div>
        </div>
        
      </div>
    </div>

    <div id="data" class="tab-content">
      
      <div style="flex-shrink: 0; padding-right: 5px; margin-bottom: 5px;">
        
        <div id="updateQueueSection" class="setting-card" style="display: none; margin-bottom: 15px; border-left: 4px solid var(--primary-color);">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                <label style="font-size:0.9em; font-weight:500; color:var(--text-main);">Update Progress</label>
                <button class="icon-btn" style="font-size:0.8em; padding:4px;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <ul class="queue-list" style="list-style:none; padding:0; margin:0;">
                <li id="step1" class="queue-item">
                    <div class="queue-content"><i class="far fa-circle"></i> Student Population Report</div>
                    <span class="step-time"></span>
                </li>
                <li id="step2" class="queue-item">
                    <div class="queue-content"><i class="far fa-circle"></i> Pinging Canvas API</div>
                    <span class="step-time"></span>
                </li>
                <li id="step3" class="queue-item">
                    <div class="queue-content"><i class="far fa-circle"></i> Checking Student's Grade book</div>
                    <span class="step-time"></span>
                </li>
                <li id="step4" class="queue-item">
                    <div class="queue-content"><i class="far fa-circle"></i> Compiling Missing Assignments Report</div>
                    <span class="step-time"></span>
                </li>
            </ul>
            <div id="queueTotalTime" style="display:none; text-align:right; font-size:0.85em; font-weight:bold; color:#10b981; margin-top:8px; border-top:1px solid rgba(0,0,0,0.05); padding-top:4px;">
                Total Time: 0.0s
            </div>
        </div>

        <div style="display:flex; gap:8px; margin-bottom:4px;">
             <input type="text" id="masterSearch" placeholder="Search Master List..." style="flex-grow:1;">
             <select id="sortSelect" style="width:auto; cursor:pointer;">
                <option value="name">Name (A-Z)</option>
                <option value="missing">Missing (High-Low)</option>
                <option value="days">Days Out (High-Low)</option>
				<option value="newest">Newest Students</option>
             </select>
        </div>
        
        <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.85em; color: var(--text-secondary); margin-bottom: 8px;">
            <span id="totalCountText" style="font-weight: 500;">Total Students: 0</span>
            <span><i class="far fa-clock"></i> Last Updated: <span id="lastUpdatedText">Never</span></span>
        </div>

      </div>

      <div class="section">
        <ul id="masterList" class="glass-list">
             </ul>
      </div>
      
      <div style="display:flex; gap:10px; margin-top:10px; flex-shrink: 0;">
          <button id="updateMasterBtn" class="btn-primary" style="margin-top:0; flex-grow:1;">Update Master List</button>
          <button id="downloadMasterBtn" class="btn-secondary" style="margin-top:0; width:auto; padding: 0 15px; display:flex; align-items:center; gap:8px;" title="Download CSV">
              <i class="fas fa-download"></i>
              <span>Download</span>
          </button>
      </div>
    </div>

    <!-- Tutorial Tab (Hidden - Not in main navigation) -->
    <div id="tutorial" class="tab-content">
      <div class="tutorial-container">
        <div class="tutorial-progress">
          <div class="tutorial-progress-bar">
            <div class="tutorial-progress-fill" id="tutorialProgress"></div>
          </div>
          <div class="tutorial-progress-text" id="tutorialProgressText">Page 1 of 1</div>
        </div>

        <div class="tutorial-page" id="tutorialPage">
          <h1 class="tutorial-header" id="tutorialHeader">Loading...</h1>
          <div class="tutorial-body" id="tutorialBody">
            <!-- Tutorial content will be rendered here -->
          </div>
        </div>

        <div class="tutorial-navigation">
          <button class="btn-secondary" id="tutorialSkipBtn">
            Skip Tutorial
          </button>
          <button class="btn-secondary" id="tutorialPrevBtn">
            <i class="fas fa-arrow-left"></i> Previous
          </button>
          <button class="btn-primary" id="tutorialNextBtn">
            Next <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </div>
    </div>

    <div id="about" class="tab-content">
      <div class="section" id="aboutContent" style="padding-right:10px;">
        <!-- Markdown content will be rendered here -->
      </div>
    </div>

    <div id="settings" class="tab-content">
      <div class="section">
        <h3>General</h3>
        <div class="setting-card" style="cursor: pointer;" id="clearMasterListBtn">
            <span>Clear Master List</span>
            <i class="fas fa-trash-alt" style="color:#ef4444; font-size:1.2em;"></i>
        </div>
        <div class="setting-card">
            <div style="flex-grow:1;">
                <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:8px;">
                    <span>Use Specific Submission Date</span>
                    <i id="useSpecificDateToggle" class="fas fa-toggle-off" style="color:gray; font-size:2.5em; cursor: pointer;"></i>
                </div>
                <div id="specificDatePicker" style="display:none; margin-top:8px;">
                    <div style="display:flex; align-items:center; gap:8px;">
                        <input type="date" id="specificDateInput" style="flex-grow:1; padding:8px; border:1px solid var(--border-color); border-radius:4px; background:var(--bg-primary); color:var(--text-primary);">
                        <button id="clearSpecificDateBtn" class="btn-secondary" style="width:auto; margin:0; padding:8px 12px;">
                            <i class="fas fa-times"></i> Clear
                        </button>
                    </div>
                    <div style="font-size:0.85em; color:var(--text-secondary); margin-top:4px;">
                        When cleared, automatically uses today's date
                    </div>
                </div>
            </div>
        </div>

        <div class="setting-card">
            <div style="flex-grow:1;">
                <div style="display:flex; align-items:center; justify-content:space-between;">
                    <div>
                        <div style="font-weight:500; margin-bottom:4px;">Tutorial</div>
                        <div style="font-size:0.85em; color:var(--text-secondary);">
                            Review the getting started guide
                        </div>
                    </div>
                    <button id="reviewTutorialBtn" class="btn-secondary" style="width:auto; margin:0; padding:8px 16px;">
                        <i class="fas fa-graduation-cap"></i> Review Tutorial
                    </button>
                </div>
            </div>
        </div>

        <h3>Connections</h3>
        <div class="setting-card">
            <div style="display:flex; align-items:center; gap:10px; flex-grow:1;">
                <img src="../../assets/excel-logo.png" style="width:28px; height:28px; border-radius:4px;" alt="Excel">
                <div style="flex-grow:1;">
                    <div style="font-weight:500;">Excel Add-in</div>
                    <div style="display:flex; align-items:center; gap:8px; margin-top:4px;">
                        <span id="excelStatusDot" style="display:inline-block; width:8px; height:8px; border-radius:50%; background-color:#ef4444;" title="Disconnected"></span>
                        <span id="excelStatusText" style="font-size:0.8em; color:var(--text-secondary);">Disconnected</span>
                    </div>
                </div>
            </div>
            <button id="configureExcelBtn" class="btn-secondary" style="width:auto; margin:0; padding: 8px 16px;">
                <i class="fas fa-cog" style="margin-right:6px;"></i>Configure
            </button>
        </div>
        <div class="setting-card">
            <div style="display:flex; align-items:center; gap:10px; flex-grow:1;">
                <img src="../../assets/power-automate-icon.png" style="width:28px; height:28px; border-radius:4px;" alt="Power Automate">
                <div style="flex-grow:1;">
                    <div style="font-weight:500;">Power Automate</div>
                    <div style="display:flex; align-items:center; gap:8px; margin-top:4px;">
                        <span id="powerAutomateStatusDot" style="display:inline-block; width:8px; height:8px; border-radius:50%; background-color:#9ca3af;" title="Not configured"></span>
                        <span id="powerAutomateStatusText" style="font-size:0.8em; color:var(--text-secondary);">Not configured</span>
                    </div>
                </div>
            </div>
            <button id="configurePowerAutomateBtn" class="btn-secondary" style="width:auto; margin:0; padding: 8px 16px;">
                <i class="fas fa-cog" style="margin-right:6px;"></i>Configure
            </button>
        </div>
        <div class="setting-card">
            <div style="display:flex; align-items:center; gap:10px; flex-grow:1;">
                <img src="../../assets/canvas-logo.png" style="width:28px; height:28px; border-radius:4px;" alt="Canvas">
                <div style="flex-grow:1;">
                    <div style="font-weight:500;">Canvas</div>
                    <div style="display:flex; align-items:center; gap:8px; margin-top:4px;">
                        <span id="canvasStatusDot" style="display:inline-block; width:8px; height:8px; border-radius:50%; background-color:#9ca3af;" title="No user logged in"></span>
                        <span id="canvasStatusText" style="font-size:0.8em; color:var(--text-secondary);">No user logged in</span>
                    </div>
                </div>
            </div>
            <button id="configureCanvasBtn" class="btn-secondary" style="width:auto; margin:0; padding: 8px 16px;">
                <i class="fas fa-cog" style="margin-right:6px;"></i>Configure
            </button>
        </div>
        <div class="setting-card">
            <div style="display:flex; align-items:center; gap:10px; flex-grow:1;">
                <img src="../../assets/five9-logo.jpg" style="width:28px; height:28px; border-radius:4px;" alt="Five9">
                <div style="flex-grow:1;">
                    <div style="font-weight:500;">Five9</div>
                    <div style="display:flex; align-items:center; gap:8px; margin-top:4px;">
                        <span id="five9StatusDot" style="display:inline-block; width:8px; height:8px; border-radius:50%; background-color:#9ca3af;" title="Not connected"></span>
                        <span id="five9StatusText" style="font-size:0.8em; color:var(--text-secondary);">Not connected</span>
                    </div>
                </div>
            </div>
            <button id="configureFive9Btn" class="btn-secondary" style="width:auto; margin:0; padding: 8px 16px;">
                <i class="fas fa-cog" style="margin-right:6px;"></i>Configure
            </button>
        </div>

        <h3>Guides</h3>
        <div id="guidesContainer">
            <!-- Guides will be dynamically populated here -->
        </div>
      </div>
    </div>

    <div id="queueModal" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Automation Queue</h3>
                <button class="icon-btn" id="closeQueueModalBtn" title="Close"><i class="fas fa-times"></i></button>
            </div>

            <div style="margin-bottom:10px; font-size:0.85em; color:var(--text-secondary);">
                <i class="fas fa-info-circle"></i> Drag to reorder • Click × to remove
            </div>

            <ul id="queueList" class="glass-list" style="min-height:100px;">
                <!-- Queue items will be populated here -->
            </ul>

            <div style="text-align:center; margin-top:15px; font-size:0.9em; color:var(--text-secondary);">
                <span id="queueCount">0 students</span> in queue
            </div>
        </div>
    </div>

    <div id="scanFilterModal" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Scan Filter Settings</h3>
                <button class="icon-btn" id="closeScanFilterBtn" title="Close"><i class="fas fa-times"></i></button>
            </div>

            <div style="margin-bottom: 20px;">
                <label style="font-size:0.95em; font-weight:500; color:var(--text-main); display:block; margin-bottom:8px;">
                    <i class="fas fa-calendar-day"></i> Days Out Threshold
                </label>
                <div style="display:flex; align-items:center; gap:10px;">
                    <select id="daysOutOperator" style="width:auto; padding:8px;">
                        <option value=">=">&gt;=</option>
                        <option value=">">&gt;</option>
                        <option value="<=">&lt;=</option>
                        <option value="<">&lt;</option>
                        <option value="=">=</option>
                    </select>
                    <input type="number" id="daysOutValue" min="0" value="5" style="flex:1; padding:8px;">
                </div>
                <div style="font-size:0.8em; color:var(--text-secondary); margin-top:5px;">
                    Only scan students matching this days out criteria
                </div>
            </div>

            <div style="margin-bottom: 20px;">
                <div class="setting-card" style="margin-bottom:0;">
                    <div style="display:flex; align-items:center; gap:10px;">
                        <i class="fas fa-exclamation-triangle" style="color:#ef4444; font-size:1.2em;"></i>
                        <div>
                            <div style="font-weight:500; color:var(--text-main);">Include Failing Students</div>
                            <div style="font-size:0.8em; color:var(--text-secondary);">Scan students with grade &lt; 60% regardless of days out</div>
                        </div>
                    </div>
                    <i id="failingToggle" class="fas fa-toggle-off" style="color:gray; font-size:2em; cursor:pointer;"></i>
                </div>
            </div>

            <div id="scanFilterCount" style="background: rgba(0, 90, 156, 0.1); border-left: 4px solid var(--primary-color); padding: 12px; border-radius: 0.75rem; margin-bottom: 15px;">
                <div style="display:flex; align-items:center; gap:10px;">
                    <i class="fas fa-users" style="color:var(--primary-color); font-size:1.2em;"></i>
                    <div>
                        <div style="font-weight:600; color:var(--text-main); font-size:0.95em;">
                            <span id="studentCountValue">0</span> students will be scanned
                        </div>
                        <div style="font-size:0.75em; color:var(--text-secondary); margin-top:2px;">
                            Based on current filter settings
                        </div>
                    </div>
                </div>
            </div>

            <button class="btn-primary" id="saveScanFilterBtn">Save Filters</button>
        </div>
    </div>

    <div id="connectionsModal" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="connectionModalTitle">Connection Settings</h3>
                <button class="icon-btn" id="closeConnectionsBtn" title="Close"><i class="fas fa-times"></i></button>
            </div>

            <div class="modal-body">
            <!-- Excel Add-in Configuration -->
            <div id="excelConfigContent" style="display:none;">
                <div style="margin-bottom: 20px;">
                    <label style="font-size:0.95em; font-weight:500; color:var(--text-main); display:block; margin-bottom:12px;">
                        <i class="fas fa-sync-alt" style="color:var(--primary-color);"></i> Automatic Master List Update
                    </label>
                    <select id="autoUpdateSelectModal" style="width:100%; padding:10px; font-size:0.95em; cursor:pointer;">
                        <option value="always">Always</option>
                        <option value="once-daily">Once a Day</option>
                        <option value="never">Never</option>
                    </select>
                    <div style="font-size:0.8em; color:var(--text-secondary); margin-top:8px;">
                        <strong>Always:</strong> Accepts all master list update requests from the Office Add-in.<br>
                        <strong>Once a Day:</strong> Only accepts the first update request each day.<br>
                        <strong>Never:</strong> Rejects all automatic update requests.
                    </div>
                </div>

                <!-- Sync Active Student -->
                <div style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <label style="font-size:0.95em; font-weight:500; color:var(--text-main);">
                            <i class="fas fa-user-check" style="color:var(--primary-color);"></i> Sync Active Student
                        </label>
                        <i id="syncActiveStudentToggleModal" class="fas fa-toggle-on" style="color:var(--primary-color); font-size:2em; cursor: pointer;"></i>
                    </div>
                    <div style="font-size:0.8em; color:var(--text-secondary);">
                        Automatically set the active student in the extension when you select a student in Excel. Supports both single and multiple student selections (automation mode).
                    </div>
                </div>

                <!-- Send Master List to Excel -->
                <div style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <label style="font-size:0.95em; font-weight:500; color:var(--text-main);">
                            <i class="fas fa-file-export" style="color:var(--primary-color);"></i> Send Master List to Excel
                        </label>
                        <i id="sendMasterListToggleModal" class="fas fa-toggle-on" style="color:var(--primary-color); font-size:2em; cursor: pointer;"></i>
                    </div>
                    <div style="font-size:0.8em; color:var(--text-secondary);">
                        Automatically send updated master list to Excel when importing via CSV/Excel file. This imports the data into the "Master List" sheet in the Office Add-in.
                    </div>
                </div>

                <!-- Highlight Student Row Configuration -->
                <div style="margin-bottom: 20px; padding-top: 20px; border-top: 1px solid rgba(0,0,0,0.1);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <label style="font-size:0.95em; font-weight:500; color:var(--text-main);">
                            <i class="fas fa-highlighter" style="color:var(--primary-color);"></i> Student Submission Highlight
                        </label>
                        <i id="highlightStudentRowToggleModal" class="fas fa-toggle-on" style="color:var(--primary-color); font-size:2em; cursor: pointer;"></i>
                    </div>
                    <div style="font-size:0.8em; color:var(--text-secondary); margin-bottom:15px;">
                        Automatically highlight student rows in Excel when a submission is detected.
                    </div>

                    <div id="highlightSettingsContainer" style="transition: opacity 0.3s;">
                    <div style="font-size:0.8em; color:var(--text-secondary); margin-bottom:15px;">
                        Configure how student rows are highlighted in Excel when a submission is detected.
                    </div>

                    <!-- Start Column -->
                    <div style="margin-bottom: 12px;">
                        <label style="font-size:0.85em; font-weight:500; color:var(--text-main); display:block; margin-bottom:6px;">
                            Start Column
                        </label>
                        <input type="text" id="highlightStartColInput" placeholder="Student Name" style="width:100%; padding:8px; font-size:0.9em; border: 1px solid rgba(0,0,0,0.2); border-radius:0.5rem;">
                        <div style="font-size:0.75em; color:var(--text-secondary); margin-top:4px;">Column name or index (0-based) where highlighting starts</div>
                    </div>

                    <!-- End Column -->
                    <div style="margin-bottom: 12px;">
                        <label style="font-size:0.85em; font-weight:500; color:var(--text-main); display:block; margin-bottom:6px;">
                            End Column
                        </label>
                        <input type="text" id="highlightEndColInput" placeholder="Outreach" style="width:100%; padding:8px; font-size:0.9em; border: 1px solid rgba(0,0,0,0.2); border-radius:0.5rem;">
                        <div style="font-size:0.75em; color:var(--text-secondary); margin-top:4px;">Column name or index (0-based) where highlighting ends</div>
                    </div>

                    <!-- Edit Column -->
                    <div style="margin-bottom: 12px;">
                        <label style="font-size:0.85em; font-weight:500; color:var(--text-main); display:block; margin-bottom:6px;">
                            Edit Column
                        </label>
                        <input type="text" id="highlightEditColumnInput" placeholder="Outreach" style="width:100%; padding:8px; font-size:0.9em; border: 1px solid rgba(0,0,0,0.2); border-radius:0.5rem;">
                        <div style="font-size:0.75em; color:var(--text-secondary); margin-top:4px;">Column name or index (0-based) to edit with submission info</div>
                    </div>

                    <!-- Edit Text -->
                    <div style="margin-bottom: 12px;">
                        <label style="font-size:0.85em; font-weight:500; color:var(--text-main); display:block; margin-bottom:6px;">
                            Edit Text
                        </label>
                        <input type="text" id="highlightEditTextInput" placeholder="Submitted {assignment}" style="width:100%; padding:8px; font-size:0.9em; border: 1px solid rgba(0,0,0,0.2); border-radius:0.5rem;">
                        <div style="font-size:0.75em; color:var(--text-secondary); margin-top:4px;">Text to insert (use {assignment} placeholder for assignment name)</div>
                    </div>

                    <!-- Target Sheet -->
                    <div style="margin-bottom: 12px;">
                        <label style="font-size:0.85em; font-weight:500; color:var(--text-main); display:block; margin-bottom:6px;">
                            Target Sheet
                        </label>
                        <input type="text" id="highlightTargetSheetInput" placeholder="LDA MM-DD-YYYY" style="width:100%; padding:8px; font-size:0.9em; border: 1px solid rgba(0,0,0,0.2); border-radius:0.5rem;">
                        <div style="font-size:0.75em; color:var(--text-secondary); margin-top:4px;">Target worksheet name (use MM-DD-YYYY for date placeholders)</div>
                    </div>

                    <!-- Highlight Color -->
                    <div style="margin-bottom: 12px;">
                        <label style="font-size:0.85em; font-weight:500; color:var(--text-main); display:block; margin-bottom:6px;">
                            Highlight Color
                        </label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="color" id="highlightRowColorInput" value="#92d050" style="width:60px; height:40px; border: 1px solid rgba(0,0,0,0.2); border-radius:0.5rem; cursor:pointer;">
                            <input type="text" id="highlightRowColorTextInput" placeholder="#92d050" style="flex:1; padding:8px; font-size:0.9em; border: 1px solid rgba(0,0,0,0.2); border-radius:0.5rem;">
                        </div>
                        <div style="font-size:0.75em; color:var(--text-secondary); margin-top:4px;">Hex color code for row highlighting</div>
                    </div>
                    </div>
                </div>
            </div>

            <!-- Power Automate Configuration -->
            <div id="powerAutomateConfigContent" style="display:none;">
                <div style="margin-bottom: 20px;">
                    <label style="font-size:0.95em; font-weight:500; color:var(--text-main); display:block; margin-bottom:12px;">
                        <i class="fas fa-link" style="color:var(--primary-color);"></i> HTTP Request URL
                    </label>
                    <input type="url" id="powerAutomateUrlInput" placeholder="https://prod-123.westus.logic.azure.com:443/workflows/..." style="width:100%; padding:10px; font-size:0.95em;">
                    <div style="font-size:0.8em; color:var(--text-secondary); margin-top:8px;">
                        Enter your Power Automate HTTP Request trigger URL. The extension will send data to this endpoint when events occur.
                    </div>
                </div>
            </div>

            <!-- Canvas Configuration -->
            <div id="canvasConfigContent" style="display:none;">
                <!-- Embed Helper -->
                <div style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <label style="font-size:0.95em; font-weight:500; color:var(--text-main);">
                            <i class="fas fa-code" style="color:var(--primary-color);"></i> Embed Helper in Canvas
                        </label>
                        <i id="embedHelperToggleModal" class="fas fa-toggle-on" style="color:var(--primary-color); font-size:2em; cursor: pointer;"></i>
                    </div>
                    <div style="font-size:0.8em; color:var(--text-secondary);">
                        Automatically embed the extension helper in Canvas pages for easier navigation.
                    </div>
                </div>

                <!-- Highlight Color -->
                <div style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <label style="font-size:0.95em; font-weight:500; color:var(--text-main);">
                            <i class="fas fa-palette" style="color:var(--primary-color);"></i> Highlight Color
                        </label>
                        <input id="highlightColorPickerModal" type="color" value="#ffff00" style="border: 1px solid rgba(0,0,0,0.1); border-radius: 4px; width: 50px; height: 35px; padding: 0; background: none; cursor: pointer;">
                    </div>
                    <div style="font-size:0.8em; color:var(--text-secondary);">
                        Choose the color used to highlight missing assignments in Canvas.
                    </div>
                </div>

                <!-- Canvas API Cache -->
                <div style="margin-bottom: 20px;">
                    <label style="font-size:0.95em; font-weight:500; color:var(--text-main); display:block; margin-bottom:12px;">
                        <i class="fas fa-database" style="color:var(--primary-color);"></i> Canvas API Cache
                    </label>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(0,0,0,0.02); border-radius: 6px; margin-bottom: 8px;">
                        <span style="font-size:0.9em;">Cached Entries</span>
                        <span id="cacheStatsTextModal" style="font-size:0.9em; color:var(--text-secondary);">Loading...</span>
                    </div>
                    <div style="font-size:0.8em; color:var(--text-secondary); margin-bottom: 12px;">
                        Canvas API responses are cached until course end dates to reduce API calls.
                    </div>
                    <button id="clearCacheBtnModal" class="btn-secondary" style="width:100%;">
                        <i class="fas fa-trash-alt" style="margin-right: 5px;"></i>
                        Clear Cache
                    </button>
                </div>
            </div>

            <!-- Five9 Configuration -->
            <div id="five9ConfigContent" style="display:none;">
                <!-- Call Demo Toggle -->
                <div style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <label style="font-size:0.95em; font-weight:500; color:var(--text-main);">
                            <i class="fas fa-phone-alt" style="color:var(--primary-color);"></i> Call Demo
                        </label>
                        <i id="debugModeToggleModal" class="fas fa-toggle-off" style="color:gray; font-size:2em; cursor: pointer;"></i>
                    </div>
                    <div style="font-size:0.8em; color:var(--text-secondary);">
                        Enable call demo mode for testing and demonstration purposes without an active Five9 session.
                    </div>
                </div>
            </div>
            </div>

            <div class="modal-footer">
                <button class="btn-primary" id="saveConnectionsBtn">Save Settings</button>
            </div>
        </div>
    </div>

    <!-- Daily Update Modal -->
    <div id="dailyUpdateModal" class="modal-overlay" style="display:none; align-items: flex-start; padding-top: 80px;">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3><i class="fas fa-sun" style="color: #f59e0b;"></i> Good Morning!</h3>
                <button class="icon-btn" id="closeDailyUpdateBtn" title="Close"><i class="fas fa-times"></i></button>
            </div>

            <div style="text-align: center; padding: 20px 30px;">
                <div style="font-size: 1.1em; color: var(--text-main); margin-bottom: 20px; line-height: 1.6;">
                    Would you like to update the master list for today?
                </div>
                <div style="font-size: 0.85em; color: var(--text-secondary); margin-bottom: 25px;">
                    <i class="fas fa-info-circle"></i> This will help ensure you have the latest student data
                </div>
                <button class="btn-primary" id="dailyUpdateBtn" style="padding: 12px 40px; font-size: 1em;">
                    <i class="fas fa-sync-alt"></i> Update Master List
                </button>
                <button class="btn-secondary" id="dailyUpdateLaterBtn" style="margin-top: 10px; padding: 10px 40px; background: transparent; color: var(--text-secondary); border: 1px solid var(--border-color);">
                    Maybe Later
                </button>
            </div>
        </div>
    </div>

    <!-- Context Menu for Update Master List Button -->
    <div id="updateMasterContextMenu" class="context-menu">
        <div class="context-menu-item" id="sendListToExcelMenuItem">
            <i class="fas fa-file-export"></i>
            <span>Send List to Excel</span>
        </div>
    </div>

    <!-- Context Menu for Checker Tab -->
    <div id="checkerContextMenu" class="context-menu">
        <div class="context-menu-item" id="resendHighlightPingMenuItem">
            <i class="fas fa-sync-alt"></i>
            <span id="checkerContextMenuText">Resend Highlight Ping</span>
        </div>
    </div>

  </div>
<input type="file" id="studentPopFile" accept=".csv, .xlsx" style="display: none;" />

  <!-- SheetJS library for Excel file parsing -->
  <script src="../lib/xlsx.full.min.js"></script>
  <script src="sidepanel.js" type="module"></script>
</body>

</html>
